function getBool(e){var t=+e;return isNaN(t)?!!String(e).toLowerCase().replace(!1,""):!!t}function componercampoagrupado(e){var t="",a=e.tipo,o=e.id,l=e.titulo,r=e.titulocaja;void 0===r&&(r=l);var i=e.codigoautocompletado,n=e.valores,c=!1;if(void 0!==e.datononormalizado&&"si"==e.datononormalizado)c=!0;switch(t=(t=htmltiposcampo[a]).replace("##ID##",o),a){case"selectsimpleauto":t=(t=(t=(t=t.replace("##CODIGOAUTOCOMPLETADO##",i)).replace('<label class="margentoplabel">##TITULO##</label>',"")).replace("##TITULOCAJA##",r)).replace("##NONORM##",c);break;case"selectsimplemanual":var s="";$.each(n,function(e,t){var a=option;a=(a=a.replace("##ID##",t)).replace("##TEXTO##",t),s+=a}),t=(t=(t=(t=t.replace('<label class="margentoplabel">##TITULO##</label>',"")).replace("##TITULOCAJA##",r)).replace("##VALORES##",s)).replace("##NONORM##",c);break;case"selectmultipleauto":t=(t=(t=(t=t.replace("##CODIGOAUTOCOMPLETADO##",i)).replace('<label class="margentoplabel">##TITULO##</label>',"")).replace("##TITULOCAJA##",r)).replace("##NONORM##",c);break;default:t=""}return t}function componercampos(){var e="";$.each(dataConfig,function(t,a){var o="",l=a.id,r=a.titulo,i=a.titulocaja;void 0===i&&(i=r);var n=a.tipo,c=a.codigoautocompletado,s=a.valores,p=!1;if(void 0!==a.datononormalizado&&"si"==a.datononormalizado)p=!0;switch(o=(o=htmltiposcampo[n]).replace("##ID##",l),n){case"selectsimpleauto":o=(o=(o=(o=o.replace("##CODIGOAUTOCOMPLETADO##",c)).replace("##TITULO##",r)).replace("##TITULOCAJA##",i)).replace("##NONORM##",p);break;case"selectsimplemanual":var u="";$.each(s,function(e,t){var a=option;a=(a=a.replace("##ID##",t)).replace("##TEXTO##",t),u+=a}),o=(o=(o=(o=o.replace("##TITULO##",r)).replace("##TITULOCAJA##",i)).replace("##VALORES##",u)).replace("##NONORM##",p);break;case"selectmultipleauto":o=(o=(o=(o=o.replace("##CODIGOAUTOCOMPLETADO##",c)).replace("##TITULO##",r)).replace("##TITULOCAJA##",i)).replace("##NONORM##",p);break;case"text":if(o=(o=o.replace("##TITULO##",r)).replace("##TITULOCAJA##",i),""!=a.limitecaracteres&&0!=a.limitecaracteres)var d=' maxlength="'+a.limitecaracteres+'"';else d="";o=o.replace("##LIMITECARACTERES##",d);break;case"number":o=(o=o.replace("##TITULO##",r)).replace("##TITULOCAJA##",i);break;case"selectsimpleagrupado":var m,f=a.select1,v=a.select2,T=a.select3;m=componercampoagrupado(f),select2=componercampoagrupado(v),o=(o=(o=o.replace("##ID##",l)).replace("##SELECT1##",m)).replace("##SELECT2##",select2);var g=a.titulo;void 0!==T?(select3=componercampoagrupado(T),o=(o=(o=(o=(o=o.replace("##SELECT3##",select3)).replace("##A1##",25)).replace("##A2##",32)).replace("##A3##",32)).replace("##A4##",10),o=void 0===g?o.replace("##TITULOAGRUP##",f.titulo+", "+v.titulo+", "+T.titulo):o.replace("##TITULOAGRUP##",g)):(o=(o=(o=(o=(o=o.replace("##SELECT3##","")).replace("##A1##",50)).replace("##A2##",40)).replace("##A3##",0)).replace("##A4##",10),o=void 0===g?o.replace("##TITULOAGRUP##",f.titulo+", "+v.titulo):o.replace("##TITULOAGRUP##",g));break;default:o=""}e+=espaciado+o}),$("#campos").html(e),$(".comon-single").each(function(e){var t=$(this).attr("placeholder"),a=getBool($(this).attr("nonorm"));$(this).select2({language:"es",theme:"bootstrap",placeholder:t,tags:a}),$(this).val("").trigger("change")}),$(".js-data-ajax").each(function(){var e=$(this).attr("placeholder"),t=$(this).attr("tipe"),a=getBool($(this).attr("nonorm"));$(this).select2({theme:"bootstrap",tags:a,placeholder:e,language:"es",ajax:{url:urlval+"endpoint/get_databne?type="+t,dataType:"json",delay:250,data:function(e){return{q:e.term}},processResults:function(e,t){return{results:e.items}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:formatRepo,templateSelection:formatRepoSelection}),$(this).val("").trigger("change")}),$.each(dataConfig,function(e,t){var a=t.tipo,o=t.id;if("selectsimpleagrupado"==a){var l=$("#add"+o),r=$("#"+o),i=t.select1.id,n=t.select2.id;if(void 0!==t.select3)var c=t.select3.id;else c="nodefinido";l.on("click",function(e){e.preventDefault();var a=$("#"+i).select2("data");""!=$("#"+i).val()&&null!=$("#"+i).val()?(idinputValuepers=a[0].id,inputValuepers=a[0].text):(idinputValuepers="",inputValuepers="");var l=$("#"+n).select2("data");if(""!=$("#"+n).val()&&null!=$("#"+n).val()?(idinputValuerol=l[0].id,inputValuerol=l[0].text):(idinputValuerol="",inputValuerol=""),void 0!==t.select3){var s=$("#"+c).select2("data");""!=$("#"+c).val()&&null!=$("#"+c).val()?(idinputValuerol3=s[0].id,inputValuerol3=s[0].text,continuarselect3=!0):(idinputValuerol3="",inputValuerol3="",continuarselect3=!1)}else continuarselect3=!0,idinputValuerol3="",inputValuerol3="";if(""!=inputValuerol&&""!=inputValuepers&&1==continuarselect3){var p=inputValuepers+": "+inputValuerol;void 0!==t.select3&&(p+=": "+inputValuerol3),r.prepend('<li class="'+o+'" dat'+i+'id="'+idinputValuepers+'" dat'+i+'txt="'+inputValuepers+'" dat'+n+'id="'+idinputValuerol+'" dat'+n+'txt="'+inputValuerol+'" dat'+c+'id="'+idinputValuerol3+'" dat'+c+'txt="'+inputValuerol3+'"> '+p+'   <i class="icono-eliminador icon fa fa-close del'+o+'"></i></li>'),$("#"+t.select1.id).val(null).trigger("change"),$("#"+t.select2.id).val(null).trigger("change"),void 0!==t.select3&&$("#"+t.select3.id).val(null).trigger("change")}else pybossaNotify("Debes introducir datos antes de a√±adir.","error",!0)}),$("body").on("click","i.del"+o,function(){$(this).parent().remove()})}})}htmltiposcampo=[],htmltiposcampo.selectsimpleauto='<label class="margentoplabel">##TITULO##</label><select id="##ID##" name="element" nonorm="##NONORM##" class="form-control js-data-ajax js-data-example-ajax" tipe="##CODIGOAUTOCOMPLETADO##" placeholder="##TITULOCAJA##"><option value=""></option></select>',htmltiposcampo.selectsimplemanual='<label class="margentoplabel">##TITULO##</label><select id="##ID##" nonorm="##NONORM##" name="element" class="form-control comon-single" placeholder="##TITULOCAJA##">##VALORES##</select>',htmltiposcampo.selectmultipleauto='<label class="margentoplabel">##TITULO##</label><select id="##ID##" nonorm="##NONORM##" name="element" class="form-control js-data-ajax js-data-example-ajax" tipe="##CODIGOAUTOCOMPLETADO##" multiple placeholder="##TITULOCAJA##"></select>',htmltiposcampo.text='<label class="margentoplabel">##TITULO##</label><input class="form-control" id="##ID##" placeholder="##TITULOCAJA##" type="text" value="" ##LIMITECARACTERES##>',htmltiposcampo.number='<label class="margentoplabel">##TITULO##</label><input class="form-control" id="##ID##" placeholder="##TITULOCAJA##" type="number" value="">',htmltiposcampo.selectsimpleagrupado='<label class="margentoplabel">##TITULOAGRUP##</label><div class="form-group"><div class="input-group"><div class="input-group-btn" style="width: ##A1##% !important;padding-right: 10px;">##SELECT1##</div><div class="input-group-btn" style="width: ##A2##% !important;padding-right: 10px;">##SELECT2##</div><div class="input-group-btn" style="width: ##A3##% !important;">##SELECT3##</div><div style="width: ##A4##% !important"><button class="btn btn-default margin-top-xs" id="add##ID##" type="button" style="margin-top: 0px;margin-left: 10px;"> <i class="fa fa-plus" aria-hidden="true"></i></button></div></div></div><div class="row"><ul id="##ID##" class="listaselectagrupado"></ul></div>',option='<option value="##ID##">##TEXTO##</option>',espaciado="<span><small>&nbsp;</small></span>";var TAB_CONTAINER=function(){"use strict";var e=0,t="Comenzar",a="Siguiente",o="prevBtn",l="nextBtn",r=document.querySelector(".contenedortuto"),i=document.querySelectorAll(".contenedortuto > div.steptuto"),n=document.querySelectorAll(".tab-buttons button");function c(e,t){!function(e){Array.prototype.map.call(e,function(e){e.style.display="none"})}(e),e[t].style.display="block"}function s(t,a,o){t.preventDefault(),t.target.classList.contains(o)?e!==a.length-1?e++:$("#modal").modal("hide"):e--}function p(e,t){return Array.prototype.filter.call(e,function(e){return e.classList.contains(t)})[0]}function u(e,t,a){e.style[t]=a}function d(e,r,i){var n=p(e,l),c=p(e,o);u(c,"visibility",0===i?"hidden":"visible"),i===r.length-1?n.textContent=t:n.textContent=a,$("#modal").animate({scrollTop:0})}function m(e,t){0!==r.scrollTop&&r.scrollTo(null,0)}return{init:function(){m(),Array.prototype.map.call(n,function(t){t.addEventListener("click",function(t){m(),s(t,i,"nextBtn"),c(i,e),d(n,i,e)})}),c(i,e),d(n,i,e)},reset:function(){e=0,c(i,0),m(),d(n,i,0)}}}();function getWindowDimensions(e){return window[{width:"innerWidth",height:"innerHeight"}[e]]}function cambiarPositionDeComentario(){var e=getWindowDimensions("width"),t=document.querySelector(".add-comentario-responsive"),a=document.querySelector(".add-comentario-desktop"),o=document.getElementById("comentario");e<=768?t.insertBefore(o,t.childNodes[-1]):a.insertBefore(o,a.childNodes[-1])}function scrollModalBody(e){var t=$(e);0!==t.scrollTop&&t.animate({scrollTop:0})}function is_url(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}function isValidURL(e){return new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}function getCookie_Layer(e){var t=document.cookie,a=t.indexOf(" "+e+"=");if(-1==a&&(a=t.indexOf(e+"=")),-1==a)t=null;else{a=t.indexOf("=",a)+1;var o=t.indexOf(";",a);-1==o&&(o=t.length),t=unescape(t.substring(a,o))}return t}function setCookie_Layer(e,t,a){var o=new Date;o.setDate(o.getDate()+a);var l=escape(t)+(null==a?"":";expires="+o.toUTCString()+";path=/");document.cookie=e+"="+l}function obtenersiguientetarea(e,t){var a=$("#body-content").attr("data-id-user"),o=$("#body-content").attr("data-url-val");$.ajax({url:o+"endpoint/get_nexttask?idproyecto="+e+"&idusuario="+a+"&idtarea="+t,data:{}}).done(function(a){if(""!=a){window.location.href.replace(t,a);$("#omitirtarea").show().attr("href","javascript:void(0);").attr("tareaid",t).attr("proyectoid",e)}else $("#omitirtarea").hide().attr("tareaid","0").attr("proyectoid","0")})}function omitir_tarea_by_id(e,t){var a="omitir"+t,o=e,l=getCookie_Layer(a);setCookie_Layer(a,null!=l?l+";"+o:o,365),window.location.href="/proyectos/"+nombreshortproyect+"/contribuir"}function loadUserProgress(){pybossa.userProgress(nombreshortproyect).done(function(e){var t=Math.round(100*e.done/e.total);$("#progress").css("width",t.toString()+"%"),$("#progress").attr("title",t.toString()+"% completed!"),$("#total strong").text(e.total),$("#done strong mark").text(e.done)})}function comprobarcamposcomunes(){"undefined"!=typeof camposcomunesConfig&&"si"!=camposcomunesConfig&&($(".campocomun").hide(),$("#omitirtarea").parent().removeClass("col-sm-6").addClass("col-sm-12"))}function cargarenlaceurl(e){if(void 0!==e.info.infoextra){var t=JSON.parse(e.info.infoextra);if($("#enlacerecurso").remove(),t.urldelrecurso.length>0){var a="<span id='enlacerecurso'><a href='"+t.urldelrecurso+"' title='Ver recurso completo' target='_blank'>Ver recurso completo</a></span>";$("#total").append(a)}}}TAB_CONTAINER.init(),cambiarPositionDeComentario(),$(document).ready(function(){function e(){$(this).closest(".select2").prev("select").select2("open")}$("#enlacesinteresbtn").popover("disable"),$("#campos .js-data-ajax, #campos .comon-single").next(".select2").find(".select2-selection").one("focus",e).on("blur",function(t){$(this).one("focus",e)}),$("#tutobut").on("click",function(){$("#modal").modal("show"),TAB_CONTAINER.reset()}),$("#addcomentario").on("click",function(){$("#comentario").toggle()});var t=$("#enlacesinteres"),a=$("#enlacesinteresbtn"),o=$("#list");a.on("click",function(e){e.preventDefault(),inputValue=$("#enlacesinteres").val(),""!=inputValue&&isValidURL(inputValue)&&is_url(inputValue)?(o.prepend('<div><li class="datoenlacefuente"> '+inputValue+'</li> <i class="eliminardatoenlacefuente icon fa fa-close"></i></div>'),$("#enlacesinteres").val("")):pybossaNotify("Debes introducir una url valida.","error",!0)}),t.on("keypress",function(e){if(13==e.keyCode)return $("#enlacesinteresbtn").click(),!1}),$("body").on("click","i.eliminardatoenlacefuente",function(){$(this).parent().remove()}),$("body").on("click","#omitirtarea",function(){var e=$(this).attr("tareaid"),t=$(this).attr("proyectoid");"0"!=e&&omitir_tarea_by_id(e,t)}),1!=getCookie_Layer("tuto_"+nombreshortproyect)&&$("#modal").modal("show"),setCookie_Layer("tuto_"+nombreshortproyect,1,365),comprobarcamposcomunes()});