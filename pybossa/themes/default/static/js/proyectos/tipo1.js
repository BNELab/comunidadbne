function createInputHidden(e,a){var t=document.createElement("input");t.setAttribute("type","hidden"),t.setAttribute("name",e),t.setAttribute("value",a),document.getElementById("formdatatipo1").appendChild(t)}function updateUrl(e,a,t){null!=t&&(t=encodeURI(t));var o=e.split("?"),n=o[0],i="",r={};if(o.length>1&&(i=o[1]),""!=i)for(l in i=i.split("&")){var d=i[l],s=(d=d.split("="))[0],c="";d.length>1&&(c=d[1]),r[s]=c}for(var l in null!=t?r[a]=t:delete r[a],i=[],r)i.push(l+"="+r[l]);var u=n;return i.length>0&&(u+="?"+i.join("&")),u}function refrescaranotaciones(){$("#listanotaciones").html("");var e=anno.getAnnotations();$(e).each(function(e,a){$("#listanotaciones").prepend('<li class="datoanotacion" data="'+e+'"> '+a.text+'   <i class="icon fa fa-close dela"></i></li>')})}function changemodo(e){1==e?($("#bloquedocumentoimagentranscribir").hide(),$("#documentopdf").show(),$("#modo").show()):($("#bloquedocumentoimagentranscribir").show(),$("#documentopdf").hide(),$("#modo").hide())}function formatRepo(e){return e.loading,e.text}function formatRepoSelection(e){return e.full_name||e.text}anno.addPlugin("FancyBoxSelector",{activate:!0}),$(document).ready(function(){anguloactual=0,$("body").on("click","button.rotate",function(){degrees=parseInt(anguloactual+90),degrees>360&&(degrees=90),anguloactual=degrees,$("#imagenlugar").css({"-webkit-transform":"rotate("+degrees+"deg)","-moz-transform":"rotate("+degrees+"deg)","-ms-transform":"rotate("+degrees+"deg)","-o-transform":"rotate("+degrees+"deg)",transform:"rotate("+degrees+"deg)",zoom:1})}),$("body").on("click","i.dela",function(){$(this).parent().remove();var e=$(this).parent().attr("data");anno.removeAnnotation(anno.getAnnotations()[e]),refrescaranotaciones()}),$("#modo,#modot").on("click",function(){changemodo($(this).attr("mode"))}),"undefined"==typeof loadcampos&&(componercampos(),$("input[maxlength]").maxlength(),"si"!=anotacionesConfig&&$("#bloqueanotaciones").hide())}),"undefined"==typeof loadcampos&&(pybossa.taskLoaded(function(e,a){if($.isEmptyObject(e))a.resolve(e);else{var t=$("<img />");if(t.load(function(){a.resolve(e)}),void 0!==e.info.resource)var o=e.info.resource;else o="http://bdh-rd.bne.es/pdf.raw?query=id:"+e.info.id+"&jpeg=true&page="+e.info.page;t.attr("src",o),t.attr("id","imagenlugartranscribir"),t.addClass("img-polaroid"),t.addClass("annotable"),e.info.image=t}}),pybossa.presentTask(function(e,a){if($.isEmptyObject(e))pybossaNotify("Ya ha contribuido en todas las tareas del proyecto, muchas gracias por su colaboración.","info",!0),$("#contenedortarea").hide(),$("#finalizado").show();else{if(cargarenlaceurl(e),obtenersiguientetarea(e.project_id,e.id),loadUserProgress(),void 0!==e.info.resource)var t=e.info.resource;else t="http://bdh-rd.bne.es/pdf.raw?query=id:"+e.info.id+"&jpeg=true&page="+e.info.page;$("#imagenlugar").attr("src",t),$("#imagenlugar").attr("data-zoom-image",t);var o=$("#documentopdf");elementozoom=o.find(".panzoom").panzoom({$zoomIn:o.find(".mas"),$zoomOut:o.find(".menos"),$zoomRange:o.find(".zoom-range"),$reset:o.find(".reset"),increment:.1,minScale:1}),$("#documentopdftranscribir").html("").append(e.info.image),anno.makeAnnotatable(document.getElementById("imagenlugartranscribir")),anno.addHandler("onAnnotationCreated",function(e){refrescaranotaciones()}),anno.addHandler("onAnnotationRemoved",function(e){refrescaranotaciones()}),anno.addHandler("onAnnotationUpdated",function(e){refrescaranotaciones()}),changemodo(1),$("#guardar").off("click").on("click",function(){var t={},o=!1;if($.each(dataConfig,function(e,a){var n=a.tipo,i=a.id;switch(n){case"selectsimpleauto":t[i+"id"]=$("#"+i).val(),""!=t[i+"id"]&&null!=t[i+"id"]?(t[i+"txt"]=$("#"+i).select2("data")[0].text,o=!0):(t[i+"id"]="",t[i+"txt"]="");break;case"selectsimplemanual":t[i+"id"]=$("#"+i).val(),null==t[i+"id"]?t[i+"id"]="":o=!0;break;case"selectmultipleauto":void 0===t[i]&&(t[i]=[]),$($("#"+i).select2("data")).each(function(e,a){o=!0,t[i].push({id:a.id,text:a.text})});break;case"text":case"number":t[i]=$("#"+i).val(),""!=t[i]&&(o=!0);break;case"selectsimpleagrupado":void 0===t[i]&&(t[i]=[]);var r=a.select1.id,d=a.select2.id;if(void 0!==a.select3)var s=a.select3.id;else s="nodefinido";$("."+i).each(function(e,a){t[i].push({["id"+r]:$(a).attr("dat"+r+"id"),["text"+r]:$(a).attr("dat"+r+"txt"),["id"+d]:$(a).attr("dat"+d+"id"),["text"+d]:$(a).attr("dat"+d+"txt"),["id"+s]:$(a).attr("dat"+s+"id"),["text"+s]:$(a).attr("dat"+s+"txt")}),o=!0})}}),t.anotaciones=anno.getAnnotations(),1==o||t.anotaciones.length){t.dataConfig=JSON.stringify(dataConfig),t.id=e.info.id,t.page=e.info.page,void 0!==e.info.resource&&(t.resource=e.info.resource),t.comentario=$("#comentario").val(),t.infoadicional=$("#infoadi").val();var n=[];$(".datoenlacefuente").each(function(e,a){""!=$(a).text()&&n.push({url:$(a).text()})}),t.enlacesfuentesdatos=n;var i=JSON.stringify(t);pybossa.saveTask(e.id,i).done(function(e){$("#comentario").val(""),$("#comentario").hide(),$("#infoadi").val(""),$(".datoenlacefuente").remove(),$(".eliminardatoenlacefuente").remove(),$.each(dataConfig,function(e,a){var t=a.tipo,o=a.id;if("selectsimpleauto"==t||"selectsimplemanual"==t||"selectmultipleauto"==t)$("#"+o).val(null).trigger("change");else if("text"==t||"number"==t)$("#"+o).val("");else if("selectsimpleagrupado"==t){$("."+o).remove();var n=a.select1,i=a.select2,r=a.select3;$("#"+n.id).val(null).trigger("change"),$("#"+i.id).val(null).trigger("change"),void 0!==r&&$("#"+r.id).val(null).trigger("change")}}),anno.reset(),$("#listanotaciones").html(""),elementozoom.panzoom("resetPan"),elementozoom.panzoom("reset"),pybossaNotify("Gracias por su contribución.","success",!0),$("html, body").animate({scrollTop:$(".container-fluid").offset().top},2e3),a.resolve()})}else pybossaNotify("Es obligatorio rellenar la siguiente información.","error",!0)})}}));